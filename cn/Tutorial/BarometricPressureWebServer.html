<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
  <title>Arduino - BarometricPressureWebServer </title>
  <link rel="shortcut icon" type="image/x-icon" href="../favicon.png">
  <link rel='stylesheet' href='../pub/skins/arduinoWide_SSO/arduinoWide_SSO.css' 
type='text/css' />
  <link href="https://plus.google.com/114839908922424087554" rel="publisher" />
    <!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 5px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
div.toc p { background-color: #f9f6d6;
    margin-top:-5px;   padding-top: 5px;
    margin-left:-5px;  padding-left: 5px;
    margin-right:-5px; padding-right: 5px;
    padding-bottom: 3px;
    border-bottom:  1px dotted #cccccc; }.editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border: 2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  td.markup1 { border-bottom: 1px solid #ccf; }
  div.faq { margin-left:2em; }
  div.faq p.question { margin: 1em 0 0.75em -2em; font-weight:bold; }
  div.faq hr { margin-left: -2em; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }
/**
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 */
.arduino  {font-family:monospace;}
.arduino .imp {font-weight: bold; color: red;}
.arduino .kw1 {color: #CC6600;}
.arduino .kw2 {color: #006699;}
.arduino .kw3 {color: #CC6600; font-weight: bold;}
.arduino .co1 {color: #7E7E7E; font-style: italic;}
.arduino .co2 {color: #7E7E7E;}
.arduino .coMULTI {color: #7E7E7E; font-style: italic;}
.arduino .es0 {color: #000099; font-weight: bold;}
.arduino .es1 {color: #000099; font-weight: bold;}
.arduino .es2 {color: #660099; font-weight: bold;}
.arduino .es3 {color: #660099; font-weight: bold;}
.arduino .es4 {color: #660099; font-weight: bold;}
.arduino .es5 {color: #006699; font-weight: bold;}
.arduino .br0 {color: #000000;}
.arduino .sy0 {color: #000000;}
.arduino .st0 {color: #0066CC;}
.arduino .nu0 {color: #000000;}
.arduino .nu6 {color: #208080;}
.arduino .nu8 {color: #208080;}
.arduino .nu12 {color: #208080;}
.arduino .nu16 {color:#800080;}
.arduino .nu17 {color:#800080;}
.arduino .nu18 {color:#800080;}
.arduino .nu19 {color:#800080;}
.arduino .me1 {color: #ff1493;}
.arduino .me2 {color: #ff1493;}
.arduino span.xtra { display:block; }

.sourceblocklink {
  text-align: right;
  font-size: smaller;
}
.sourceblocktext {
  padding: 0.5em;
  color: #000000;
  background-color: #ffffff;
}
.sourceblocktext div {
  font-family: monospace;
  font-size: small;
  line-height: 1;
  height: 1%;
}
.sourceblocktext div.head,
.sourceblocktext div.foot {
  font: italic medium serif;
  padding: 0.5em;
}

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>  <meta name='robots' content='index,follow' />

  <meta name="verify-v1" content="TtxFIEJAB6zdJ509wLxjnapQzKAMNm9u0Wj4ho6wxIY=" />
  <script src="https://id.arduino.cc/css/sso_bar_js_2.php?s=reference"></script>
  <link rel="stylesheet" type="text/css" media="screen" href="../../../id.arduino.cc/css/sso_bar.css" />
</head>
<body>

		<div id="ssotoolbar">
		  <div id="al">
			<nobr><div id="ssoNavBar">&nbsp;</div></nobr>
		  </div>
		  <div id="ar">
			<nobr>
			  <div id="loginInfo"><div id="loading">Loading...</div></div>
			</nobr>
		  </div>
		</div>
		<script>ssoGenerateNavigationBar('');</script>
<div id="page">
<!--PageHeaderFmt-->
<div id="pageheader">
  <div class="title"><a href='../../en.html'>Arduino</a></div>
  <div class="search">
    <!-- SiteSearch Google -->
    <FORM method=GET action="http://www.google.com/search">
    <input type=hidden name=ie value=UTF-8>
    <input type=hidden name=oe value=UTF-8>
    <INPUT TYPE=text name=q size=25 maxlength=255 value="">
    <INPUT type=submit name=btnG VALUE="search">
    <input type=hidden name=domains value="http://arduino.cc/">
    <input type=hidden name=sitesearch value="http://arduino.cc/">
    </FORM>
    <!-- SiteSearch Google -->
  </div>
</div>
<!--/PageHeaderFmt-->
<!--PageLeftFmt-->
<div id="pagenav">
  <div id="navbar">
  	<p><a class='wikilink' href='../Main/Buy.html'>Buy</a>
<a class='wikilink' href='../Main/Software.html'>Download</a>
<a class='wikilink' href='../Guide/HomePage.html'>Getting Started</a>
<a class='wikilink' href='HomePage.html'>Learning</a>
<a class='wikilink' href='../Reference/HomePage.html'>Reference</a>
<a class='wikilink' href='../Main/Hardware.html'>Hardware</a>
<a class='wikilink' href='../Main/FAQ.html'>FAQ</a>
</p>
<p class='vspace'></p>

  </div>
</div>
<!--/PageLeftFmt-->
<div id="pagetext">
<!--PageText-->
<div id='wikitext'>
<p><strong>Learning</strong> &nbsp;  <a class='wikilink' href='HomePage.html'>Examples</a> | <a class='wikilink' href='Foundations.html'>Foundations</a> | <a class='wikilink' href='../Hacking/HomePage.html'>Hacking</a> | <a class='wikilink' href='Links.html'>Links</a>
</p>
<p class='vspace'></p><p><em>Examples &gt; Ethernet <span class='wikiword'>LIbrary</span></em>
</p>
<p class='vspace'></p><h3>Barometric Pressure Web Server</h3>
<p>This example shows how to use SPI communications to read data from <a class='urllink' href='http://www.sparkfun.com/commerce/product_info.php?products_id=8161' rel='nofollow'>a SCP1000 Barometric Pressure sensor</a>, and how to then post that data to the web by using your Arduino/Ethernet Shield combo as a simple web server. Using the Ethernet library, your device will be able to answer HTTP requests by responding with just enough HTML for a browser to display the temperature and barometric pressure values outputted by your sensor. After completing your circuit and uploading the example code below, simply navigate to your Ethernet shield's IP address, in a browser, to see this information.
</p>
<p class='vspace'></p><p>See the <a class='wikilink' href='BarometricPressureSensor.html'>Barometric Pressure Sensor</a> example for more on how the sensor works.
</p>
<p class='vspace'></p><div  class='BOM' >
<h3>Hardware Required</h3>
<ul><li><span class='wikiword'>SCP1000</span> Pressure Sensor Breakout Board
</li><li>Arduino Ethernet Shield
</li></ul></div>
<p class='vspace'></p><h3>Circuit</h3>
<div  class='circuit' >
<p>Your Barometric Pressure sensor will be attached to pins 6,7, and 11 - 13 of your Arduino/Ethernet shield combo, and powered via your device's 3.3 volt output. Connect the DRDY (Data Ready) pin on your sensor to digital pin 6 on your combo, and the CSB pin (Chip Select) to digital pin 7. Your sensor's MOSI (Master Out Slave In) pin should then be connected to digital pin 11, and it's counterpart MISO (Master In Slave Out) to digital pin 12. Finally, connect the SCK pin, the SPI clock input on your sensor, to digital pin 13 on your device, and make sure that the two share a common ground. 
</p>
<p class='vspace'></p><p>After wiring your sensor, your shield should be connected to a network with an ethernet cable. You will need to change the network settings in the program to correspond to your network.
</p>
<p class='vspace'></p><div><a class='urllink' href='../uploads/Tutorial/BaromettricPressureSensorWebServer_bb.png' rel='nofollow'><img height='300px' src='../uploads/Tutorial/BaromettricPressureSensorWebServer_bb.png' alt='' title='' /></a></div>
<p class='vspace'></p><p><span style='font-size:83%'>image developed using <a class='urllink' href='http://www.fritzing.org/' rel='nofollow'>Fritzing</a>. For more circuit examples, see the <a class='urllink' href='http://fritzing.org/projects/' rel='nofollow'>Fritzing project page</a> </span>
</p>
<p class='vspace'></p><p><strong><em>In the above  image, the Arduino would be stacked below the Ethernet shield.</em></strong>
</p>
<p class='vspace'></p></div>
<p class='vspace'></p><h3>Schematic</h3>
<div  class='circuit' >
<div><a class='urllink' href='../uploads/Tutorial/BaromettricPressureSensorWebServer_sch.png' rel='nofollow'><img height='300px' src='../uploads/Tutorial/BaromettricPressureSensorWebServer_sch.png' alt='' title='' /></a></div>
</div>
<p class='vspace'></p><h3>Code</h3>
<div  class='code' >
<p>
<div class='sourceblock ' id='sourceblock1'>
  <div class='sourceblocktext'><div class="arduino"><span class="coMULTI">/*<br />
&nbsp; SCP1000 Barometric Pressure Sensor Display<br />
&nbsp;<br />
&nbsp;Serves the output of a Barometric Pressure Sensor as a web page.<br />
&nbsp;Uses the SPI library. For details on the sensor, see:<br />
&nbsp;http://www.sparkfun.com/commerce/product_info.php?products_id=8161<br />
&nbsp;http://www.vti.fi/en/support/obsolete_products/pressure_sensors/<br />
&nbsp;<br />
&nbsp;This sketch adapted from Nathan Seidle's SCP1000 example for PIC:<br />
&nbsp;http://www.sparkfun.com/datasheets/Sensors/SCP1000-Testing.zip<br />
&nbsp;<br />
&nbsp;Circuit:<br />
&nbsp;SCP1000 sensor attached to pins 6,7, and 11 - 13:<br />
&nbsp;DRDY: pin 6<br />
&nbsp;CSB: pin 7<br />
&nbsp;MOSI: pin 11<br />
&nbsp;MISO: pin 12<br />
&nbsp;SCK: pin 13<br />
&nbsp;<br />
&nbsp;created 31 July 2010<br />
&nbsp;by Tom Igoe<br />
&nbsp;*/</span><br />
<br />
<span class="co2">#include &lt;Ethernet.h&gt;</span><br />
<span class="co1">// the sensor communicates using SPI, so include the library:</span><br />
<span class="co2">#include &lt;SPI.h&gt;</span><br />
<br />
<br />
<span class="co1">// assign a MAC address for the ethernet controller.</span><br />
<span class="co1">// fill in your address here:</span><br />
<span class="kw1">byte</span> mac<span class="br0">&#91;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="br0">&#123;</span> <br />
&nbsp; <span class="nu12">0xDE</span><span class="sy0">,</span> <span class="nu12">0xAD</span><span class="sy0">,</span> <span class="nu12">0xBE</span><span class="sy0">,</span> <span class="nu12">0xEF</span><span class="sy0">,</span> <span class="nu12">0xFE</span><span class="sy0">,</span> <span class="nu12">0xED</span><span class="br0">&#125;</span><span class="sy0">;</span><br />
<span class="co1">// assign an IP address for the controller:</span><br />
IPAddress ip<span class="br0">&#40;</span><span class="nu0">192</span><span class="sy0">,</span><span class="nu0">168</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">20</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
IPAddress gateway<span class="br0">&#40;</span><span class="nu0">192</span><span class="sy0">,</span><span class="nu0">168</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
IPAddress subnet<span class="br0">&#40;</span><span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
<br />
<span class="co1">// Initialize the Ethernet server library</span><br />
<span class="co1">// with the IP address and port you want to use </span><br />
<span class="co1">// (port 80 is default for HTTP):</span><br />
EthernetServer server<span class="br0">&#40;</span><span class="nu0">80</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
<br />
<span class="co1">//Sensor's memory register addresses:</span><br />
const <span class="kw1">int</span> PRESSURE <span class="sy0">=</span> <span class="nu12">0x1F</span><span class="sy0">;</span> &nbsp; &nbsp; &nbsp;<span class="co1">//3 most significant bits of pressure</span><br />
const <span class="kw1">int</span> PRESSURE_LSB <span class="sy0">=</span> <span class="nu12">0x20</span><span class="sy0">;</span> &nbsp;<span class="co1">//16 least significant bits of pressure</span><br />
const <span class="kw1">int</span> TEMPERATURE <span class="sy0">=</span> <span class="nu12">0x21</span><span class="sy0">;</span> &nbsp; <span class="co1">//16 bit temperature reading</span><br />
<br />
<span class="co1">// pins used for the connection with the sensor</span><br />
<span class="co1">// the others you need are controlled by the SPI library):</span><br />
const <span class="kw1">int</span> dataReadyPin <span class="sy0">=</span> <span class="nu0">6</span><span class="sy0">;</span> <br />
const <span class="kw1">int</span> chipSelectPin <span class="sy0">=</span> <span class="nu0">7</span><span class="sy0">;</span><br />
<br />
<span class="kw1">float</span> temperature <span class="sy0">=</span> <span class="nu16">0.0</span><span class="sy0">;</span><br />
<span class="kw1">long</span> pressure <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span><br />
<span class="kw1">long</span> lastReadingTime <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span><br />
<br />
<span class="kw1">void</span> <span class="kw3">setup</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; <span class="co1">// start the SPI library:</span><br />
&nbsp; SPI.<span class="kw1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">// start the Ethernet connection and the server:</span><br />
&nbsp; Ethernet.<span class="kw1">begin</span><span class="br0">&#40;</span>mac<span class="sy0">,</span> ip<span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; server.<span class="kw1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">// initalize the &nbsp;data ready and chip select pins:</span><br />
&nbsp; <span class="kw1">pinMode</span><span class="br0">&#40;</span>dataReadyPin<span class="sy0">,</span> <span class="kw2">INPUT</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="kw1">pinMode</span><span class="br0">&#40;</span>chipSelectPin<span class="sy0">,</span> <span class="kw2">OUTPUT</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">begin</span><span class="br0">&#40;</span><span class="nu0">9600</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">//Configure SCP1000 for low noise configuration:</span><br />
&nbsp; writeRegister<span class="br0">&#40;</span><span class="nu12">0x02</span><span class="sy0">,</span> <span class="nu12">0x2D</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; writeRegister<span class="br0">&#40;</span><span class="nu12">0x01</span><span class="sy0">,</span> <span class="nu12">0x03</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; writeRegister<span class="br0">&#40;</span><span class="nu12">0x03</span><span class="sy0">,</span> <span class="nu12">0x02</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">// give the sensor and Ethernet shield time to set up:</span><br />
&nbsp; <span class="kw1">delay</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">//Set the sensor to high resolution mode tp start readings:</span><br />
&nbsp; writeRegister<span class="br0">&#40;</span><span class="nu12">0x03</span><span class="sy0">,</span> <span class="nu12">0x0A</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
<span class="br0">&#125;</span><br />
<br />
<span class="kw1">void</span> <span class="kw3">loop</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <br />
&nbsp; <span class="co1">// check for a reading no more than once a second.</span><br />
&nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">millis</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">-</span> lastReadingTime <span class="sy0">&gt;</span> <span class="nu0">1000</span><span class="br0">&#41;</span><span class="br0">&#123;</span><br />
&nbsp; &nbsp; <span class="co1">// if there's a reading ready, read it:</span><br />
&nbsp; &nbsp; <span class="co1">// don't do anything until the data ready pin is high:</span><br />
&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">digitalRead</span><span class="br0">&#40;</span>dataReadyPin<span class="br0">&#41;</span> <span class="sy0">==</span> <span class="kw2">HIGH</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; &nbsp; getData<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; <span class="co1">// timestamp the last time you got a reading:</span><br />
&nbsp; &nbsp; &nbsp; lastReadingTime <span class="sy0">=</span> <span class="kw1">millis</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; <span class="br0">&#125;</span><br />
&nbsp; <span class="br0">&#125;</span><br />
<br />
&nbsp; <span class="co1">// listen for incoming Ethernet connections:</span><br />
&nbsp; listenForEthernetClients<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<span class="br0">&#125;</span><br />
<br />
<br />
<span class="kw1">void</span> getData<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot;Getting reading&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="co1">//Read the temperature data</span><br />
&nbsp; <span class="kw1">int</span> tempData <span class="sy0">=</span> readRegister<span class="br0">&#40;</span><span class="nu12">0x21</span><span class="sy0">,</span> <span class="nu0">2</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">// convert the temperature to celsius and display it:</span><br />
&nbsp; temperature <span class="sy0">=</span> <span class="br0">&#40;</span><span class="kw1">float</span><span class="br0">&#41;</span>tempData <span class="sy0">/</span> <span class="nu16">20.0</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="co1">//Read the pressure data highest 3 bits:</span><br />
&nbsp; <span class="kw1">byte</span> &nbsp;pressureDataHigh <span class="sy0">=</span> readRegister<span class="br0">&#40;</span><span class="nu12">0x1F</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span> &nbsp; <br />
&nbsp; pressureDataHigh <span class="sy0">&amp;=</span> <span class="nu6">0b00000111</span><span class="sy0">;</span> <span class="co1">//you only needs bits 2 to 0</span><br />
<br />
&nbsp; <span class="co1">//Read the pressure data lower 16 bits:</span><br />
&nbsp; <span class="kw1">unsigned</span> <span class="kw1">int</span> pressureDataLow <span class="sy0">=</span> readRegister<span class="br0">&#40;</span><span class="nu12">0x20</span><span class="sy0">,</span> <span class="nu0">2</span><span class="br0">&#41;</span><span class="sy0">;</span> &nbsp; &nbsp;<br />
&nbsp; <span class="co1">//combine the two parts into one 19-bit number:</span><br />
&nbsp; pressure <span class="sy0">=</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>pressureDataHigh <span class="sy0">&lt;&lt;</span> <span class="nu0">16</span><span class="br0">&#41;</span> <span class="sy0">|</span> pressureDataLow<span class="br0">&#41;</span><span class="sy0">/</span><span class="nu0">4</span><span class="sy0">;</span><br />
<br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">print</span><span class="br0">&#40;</span><span class="st0">&quot;Temperature: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">print</span><span class="br0">&#40;</span>temperature<span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot; degrees C&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">print</span><span class="br0">&#40;</span><span class="st0">&quot;Pressure: &quot;</span> <span class="sy0">+</span> String<span class="br0">&#40;</span>pressure<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="kw1">Serial</span>.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot; Pa&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
<span class="br0">&#125;</span><br />
<br />
<span class="kw1">void</span> listenForEthernetClients<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; <span class="co1">// listen for incoming clients</span><br />
&nbsp; EthernetClient client <span class="sy0">=</span> server.<span class="kw1">available</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>client<span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; <span class="kw1">Serial</span>.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot;Got a client&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; <span class="co1">// an http request ends with a blank line</span><br />
&nbsp; &nbsp; <span class="kw1">boolean</span> currentLineIsBlank <span class="sy0">=</span> <span class="kw1">true</span><span class="sy0">;</span><br />
&nbsp; &nbsp; <span class="kw1">while</span> <span class="br0">&#40;</span>client.<span class="kw1">connected</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>client.<span class="kw1">available</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">char</span> c <span class="sy0">=</span> client.<span class="kw1">read</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// if you've gotten to the end of the line (received a newline</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// character) and the line is blank, the http request has ended,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// so you can send a reply</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>c <span class="sy0">==</span> <span class="st0">'<span class="es1">\n</span>'</span> <span class="sy0">&amp;&amp;</span> currentLineIsBlank<span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// send a standard http response header</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot;HTTP/1.1 200 OK&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot;Content-Type: text/html&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">println</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// print the current readings, in HTML format:</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">print</span><span class="br0">&#40;</span><span class="st0">&quot;Temperature: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">print</span><span class="br0">&#40;</span>temperature<span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">print</span><span class="br0">&#40;</span><span class="st0">&quot; degrees C&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot;&lt;br /&gt;&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">print</span><span class="br0">&#40;</span><span class="st0">&quot;Pressure: &quot;</span> <span class="sy0">+</span> String<span class="br0">&#40;</span>pressure<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">print</span><span class="br0">&#40;</span><span class="st0">&quot; Pa&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.<span class="kw1">println</span><span class="br0">&#40;</span><span class="st0">&quot;&lt;br /&gt;&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">break</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>c <span class="sy0">==</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// you're starting a new line</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentLineIsBlank <span class="sy0">=</span> <span class="kw1">true</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span> <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>c <span class="sy0">!=</span> <span class="st0">'<span class="es1">\r</span>'</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// you've gotten a character on the current line</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentLineIsBlank <span class="sy0">=</span> <span class="kw1">false</span><span class="sy0">;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br />
&nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br />
&nbsp; &nbsp; <span class="br0">&#125;</span><br />
&nbsp; &nbsp; <span class="co1">// give the web browser time to receive the data</span><br />
&nbsp; &nbsp; <span class="kw1">delay</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; &nbsp; <span class="co1">// close the connection:</span><br />
&nbsp; &nbsp; client.<span class="kw1">stop</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br />
&nbsp; <span class="br0">&#125;</span><br />
<span class="br0">&#125;</span> <br />
<br />
<br />
<span class="co1">//Send a write command to SCP1000</span><br />
<span class="kw1">void</span> writeRegister<span class="br0">&#40;</span><span class="kw1">byte</span> registerName<span class="sy0">,</span> <span class="kw1">byte</span> registerValue<span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; <span class="co1">// SCP1000 expects the register name in the upper 6 bits</span><br />
&nbsp; <span class="co1">// of the byte:</span><br />
&nbsp; registerName <span class="sy0">&lt;&lt;=</span> <span class="nu0">2</span><span class="sy0">;</span><br />
&nbsp; <span class="co1">// command (read or write) goes in the lower two bits:</span><br />
&nbsp; registerName <span class="sy0">|=</span> <span class="nu6">0b00000010</span><span class="sy0">;</span> <span class="co1">//Write command</span><br />
<br />
&nbsp; <span class="co1">// take the chip select low to select the device:</span><br />
&nbsp; <span class="kw1">digitalWrite</span><span class="br0">&#40;</span>chipSelectPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
<br />
&nbsp; SPI.<span class="kw1">transfer</span><span class="br0">&#40;</span>registerName<span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">//Send register location</span><br />
&nbsp; SPI.<span class="kw1">transfer</span><span class="br0">&#40;</span>registerValue<span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">//Send value to record into register</span><br />
<br />
&nbsp; <span class="co1">// take the chip select high to de-select:</span><br />
&nbsp; <span class="kw1">digitalWrite</span><span class="br0">&#40;</span>chipSelectPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
<span class="br0">&#125;</span><br />
<br />
<br />
<span class="co1">//Read register from the SCP1000:</span><br />
<span class="kw1">unsigned</span> <span class="kw1">int</span> readRegister<span class="br0">&#40;</span><span class="kw1">byte</span> registerName<span class="sy0">,</span> <span class="kw1">int</span> numBytes<span class="br0">&#41;</span> <span class="br0">&#123;</span><br />
&nbsp; <span class="kw1">byte</span> inByte <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// incoming from &nbsp;the SPI read</span><br />
&nbsp; <span class="kw1">unsigned</span> <span class="kw1">int</span> result <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> &nbsp; <span class="co1">// result to return </span><br />
<br />
&nbsp; <span class="co1">// SCP1000 expects the register name in the upper 6 bits</span><br />
&nbsp; <span class="co1">// of the byte:</span><br />
&nbsp; registerName <span class="sy0">&lt;&lt;=</span> &nbsp;<span class="nu0">2</span><span class="sy0">;</span><br />
&nbsp; <span class="co1">// command (read or write) goes in the lower two bits:</span><br />
&nbsp; registerName <span class="sy0">&amp;=</span> <span class="nu6">0b11111100</span><span class="sy0">;</span> <span class="co1">//Read command</span><br />
<br />
&nbsp; <span class="co1">// take the chip select low to select the device:</span><br />
&nbsp; <span class="kw1">digitalWrite</span><span class="br0">&#40;</span>chipSelectPin<span class="sy0">,</span> <span class="kw2">LOW</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
&nbsp; <span class="co1">// send the device the register you want to read:</span><br />
&nbsp; <span class="kw1">int</span> command <span class="sy0">=</span> SPI.<span class="kw1">transfer</span><span class="br0">&#40;</span>registerName<span class="br0">&#41;</span><span class="sy0">;</span> <br />
&nbsp; <span class="co1">// send a value of 0 to read the first byte returned:</span><br />
&nbsp; inByte <span class="sy0">=</span> SPI.<span class="kw1">transfer</span><span class="br0">&#40;</span><span class="nu12">0x00</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
&nbsp; <br />
&nbsp; result <span class="sy0">=</span> inByte<span class="sy0">;</span><br />
&nbsp; <span class="co1">// if there's more than one byte returned, </span><br />
&nbsp; <span class="co1">// shift the first byte then get the second byte:</span><br />
&nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>numBytes <span class="sy0">&gt;</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#123;</span><br />
&nbsp; &nbsp; result <span class="sy0">=</span> inByte <span class="sy0">&lt;&lt;</span> <span class="nu0">8</span><span class="sy0">;</span><br />
&nbsp; &nbsp; inByte <span class="sy0">=</span> SPI.<span class="kw1">transfer</span><span class="br0">&#40;</span><span class="nu12">0x00</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
&nbsp; &nbsp; result <span class="sy0">=</span> result <span class="sy0">|</span>inByte<span class="sy0">;</span><br />
&nbsp; <span class="br0">&#125;</span><br />
&nbsp; <span class="co1">// take the chip select high to de-select:</span><br />
&nbsp; <span class="kw1">digitalWrite</span><span class="br0">&#40;</span>chipSelectPin<span class="sy0">,</span> <span class="kw2">HIGH</span><span class="br0">&#41;</span><span class="sy0">;</span> <br />
&nbsp; <span class="co1">// return the result:</span><br />
&nbsp; <span class="kw1">return</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span><br />
<span class="br0">&#125;</span></div></div>
  <div class='sourceblocklink'><a href='BarometricPressureWebServerf687.html?action=sourceblock&amp;num=1' type='text/plain'>[Get Code]</a></div>
</div>

</p></div>
<p class='vspace'></p><h3>See Also:</h3>
<ul><li><a class='wikilink' href='../Main/ArduinoEthernetShield.html'>Arduino Ethernet Shield</a>
</li><li><a class='wikilink' href='../Guide/ArduinoEthernetShield.html'>Getting started with the ethernet shield</a>
</li><li><a class='wikilink' href='../Reference/Ethernet.html'>Ethernet library</a>
</li><li><a class='wikilink' href='ChatServer.html'>ChatServer</a> 
</li><li><a class='wikilink' href='ChatClient.html'>ChatClient</a>
</li><li><a class='wikilink' href='WebClient.html'>WebClient</a> 
</li><li><a class='wikilink' href='WebServer.html'>WebServer</a> 
</li><li><a class='wikilink' href='PachubeCient.html'>PachubeCient</a>
</li><li><a class='selflink' href='BarometricPressureWebServer.html'>BarometricPressureWebServer</a>
</li><li><a class='wikilink' href='UDPSendReceiveString.html'>UDPSendReceiveString</a>
</li><li><a class='wikilink' href='UdpNtpClient.html'>UdpNtpClient</a>
</li></ul><p class='vspace'></p>
</div>


<!-- AddThis Button BEGIN -->
<script type="text/javascript">var addthis_language = "en";
</script>
<div class="addthis_container addthis_toolbox addthis_default_style" addthis:url="http://arduino.cc/en/Tutorial/BarometricPressureWebServer" addthis:title="Arduino Wiki English">
<a href="http://www.addthis.com/bookmark.php?v=250&amp;username=arduinoteam" class="addthis_button_compact">Share</a><span 
class="addthis_separator">|</span><a class="addthis_button_email"></a><a class="addthis_button_favorites"></a><a class="addthis_button_print"></a><a 
class="addthis_button_facebook"></a><a class="addthis_button_twitter"></a><script type="text/javascript" 
src="../../../s7.addthis.com/js/250/addthis_widget.js#username=arduinoteam"></script></div>
<!-- AddThis Button END -->

</div>
<!--PageFooterFmt-->
<div id="pagefooter">
&copy;Arduino | 
  <a href='BarometricPressureWebServer264b.html?action=edit'>Edit Page</a> | <a href='BarometricPressureWebServerad68.html?action=diff'>Page History</a> | <a href='BarometricPressureWebServer60ee.html?action=print' target='_blank'>Printable View</a> | <a href='../Site/AllRecentChanges.html'>All Recent Site Changes</a>
</div>
<!--/PageFooterFmt-->
</div>

<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? 
"https://stats.arduino.cc/piwik/" : "http://stats.arduino.cc/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img 
src="http://stats.arduino.cc/piwik/piwik.php?idsite=1" style="border:0" 
alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

</body>
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>
